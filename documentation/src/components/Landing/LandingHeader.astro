---
import ThemeSwitch from "../Header/ThemeSwitch.astro";
import Search from "../Header/Search.astro";
import DropDownMenu from "../DropDownMenu.astro";
import MobileHeader from "../Header/MobileHeader.astro";
import MobileNavigation from "../MobileNavigation.astro";
import Github from "@icons/Github.astro";
import Telegram from "@icons/Telegram.astro";
import { LINKS } from "../../consts";
import { DESKTOP_NAVIGATION } from "../../navigation";
import { getTextLocalized } from "../../languages";

interface Props {
  lang?: "en" | "ru" | "uz";
}

const { lang = "en" } = Astro.props;
const telegramLink = lang === "ru" ? LINKS.telegramRU : LINKS.telegramEN;

const apiNavigation = DESKTOP_NAVIGATION.find((item) => item.text.en === "API");
const apiLinks = apiNavigation && "items" in apiNavigation ? apiNavigation.items ?? [] : [];
const apiMenuLinks =
  apiLinks.length > 0
    ? apiLinks
    : [{ text: { en: "API", ru: "API", uz: "API" }, link: "/api" }];
const apiLabel = apiNavigation ? getTextLocalized(apiNavigation, lang) : "API";
const guidesLink = `/${lang}/guides/server-side-rendering`;

const learnLabel = { en: "Learn", ru: "Изучение", uz: "O'rganish" };
const guidesLabel = { en: "Guides", ru: "Гайды", uz: "Qo'llanmalar" };
const ecosystemLabel = { en: "Ecosystem", ru: "Экосистема", uz: "Ekotizim" };
---

<!-- Mobile Header -->
<MobileHeader lang={lang} />
<MobileNavigation />

<!-- Desktop Header -->
<header class="landing-header">
  <div class="header-left">
    <nav class="header-nav">
      <a href={`/${lang}/introduction/get-started`} class="nav-link">
        {getTextLocalized({ text: learnLabel }, lang)}
      </a>
      <a href={guidesLink} class="nav-link">
        {getTextLocalized({ text: guidesLabel }, lang)}
      </a>
      <DropDownMenu class="nav-dropdown api-dropdown" links={apiMenuLinks}>
        <span>{apiLabel}</span>
      </DropDownMenu>
      <a href={`/${lang}/introduction/ecosystem`} class="nav-link">
        {getTextLocalized({ text: ecosystemLabel }, lang)}
      </a>
    </nav>
  </div>
  <div class="header-right">
    <div class="header-search">
      <Search />
    </div>
    <a href={LINKS.github} target="_blank" rel="noopener noreferrer" class="icon-link" title="GitHub">
      <Github size={20} />
    </a>
    <a href={telegramLink} target="_blank" rel="noopener noreferrer" class="icon-link" title="Telegram">
      <Telegram size={20} />
    </a>
    <ThemeSwitch />
  </div>
</header>

<style>
  /* Desktop Header */
  .landing-header {
    display: none;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-2) var(--space-3);
    background-color: color-mix(in srgb, var(--theme-bg-sidebar-tabs-bg) 80%, transparent);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--theme-sidebar-surface-border, var(--theme-sidebar-border));
    border-radius: 9999px;
    margin: var(--space-4) var(--space-4);
    position: sticky;
    top: var(--space-4);
    z-index: 100;
  }

  /* Show desktop header on md+ */
  @media (min-width: 768px) {
    .landing-header {
      display: flex;
      margin: var(--space-4) var(--space-8);
    }
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: var(--space-4);
  }

  .header-search {
    border: 1px solid var(--theme-sidebar-surface-border, var(--theme-sidebar-border));
    border-radius: 9999px;
    background-color: var(--theme-bg-sidebar-main-tabs);
  }

  .header-search :global(button[data-open-modal]) {
    background-color: transparent;
    border: none;
    padding: 0.375rem 0.75rem;
  }

  .header-nav {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .nav-link {
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    color: var(--theme-text);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s;
  }

  .nav-link:hover {
    color: var(--theme-accent);
  }

  :global(.nav-dropdown .menu-button) {
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-weight: 500;
    transition: color 0.2s;
  }

  :global(.nav-dropdown .menu-button:hover) {
    color: var(--theme-accent);
  }

  :global(.api-dropdown .menu-button) {
    border: 1px solid var(--theme-sidebar-surface-border, var(--theme-sidebar-border));
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .icon-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 9999px;
    color: var(--theme-text);
    background-color: var(--theme-bg-sidebar-main-tabs);
    border: 1px solid var(--theme-sidebar-surface-border, var(--theme-sidebar-border));
    transition: background-color 0.2s, color 0.2s;
  }

  .icon-link:hover {
    background-color: var(--theme-bg-sidebar-main-tabs-active);
    color: var(--theme-text-light);
  }

  .header-right :global(.theme-switch) {
    min-height: 32px;
    min-width: 32px;
    width: 32px;
    height: 32px;
    border: 1px solid var(--theme-sidebar-surface-border, var(--theme-sidebar-border));
    background-color: var(--theme-bg-sidebar-main-tabs);
  }

  .header-right :global(.theme-switch .toggle-button) {
    width: 32px;
    height: 32px;
    padding: 0;
  }

  .header-right :global(.theme-switch:hover) {
    background-color: var(--theme-bg-sidebar-main-tabs-active);
  }
</style>
